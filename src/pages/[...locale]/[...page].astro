---
import MainPageLayout from '@layouts/MainPageLayout.astro';
import Cover from '@components/Cover.astro';
import PostPage from '@components/PostPage.astro';
import Navi from '@components/control/Navi.astro';
import BackTop from '@components/control/BackTop.astro';

import { getBlogEntrySort } from '@utils/content-utils'
import { siteConfig } from '@/config';
import { i18n } from "astro:config/client";
import type { GetStaticPaths } from 'astro';
import { getRelativeLocaleUrl } from '@utils/url-utils';

import i18nit from '@i18n/translation'

// 所有分页数据都在 "page" 参数中传递
const { page } = Astro.props;
const { locale = i18n!.defaultLocale } = Astro.params;

const currentLang = Astro.currentLocale || i18n!.defaultLocale;
const t = i18nit(currentLang);

export const getStaticPaths = (async ({ paginate }) => {

  // 如果启用了国际化，为每个语言环境生成分页路径
  const paths = [];
  for (const locale of i18n.locales) {
    const localeCode = typeof locale === 'string' ? locale : locale.path;
    const localeParam = localeCode === i18n.defaultLocale ? undefined : localeCode;
    const blogEntries = await getBlogEntrySort(localeParam);
    const sortedBlogEntries = [...blogEntries].sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
    const paginatedPaths = paginate(sortedBlogEntries, { 
      pageSize: siteConfig.pageSize,
      params: { locale: localeParam }
    });
    
    // 将生成的路径添加到总路径列表中
    paths.push(...paginatedPaths);
  }
  
  return paths;
}) satisfies GetStaticPaths



const indexPage = getRelativeLocaleUrl(locale, '/');
const pageTitle = `${siteConfig.title} - ${siteConfig.subTitle}`;

---

<MainPageLayout title={pageTitle} lang={currentLang}>
    <Cover title={t("cover.title.home")} subTitle={t("cover.subTitle.home")} />
    <PostPage page={page} />
    <Navi page={page} />
    <BackTop />
</MainPageLayout>